#{
  form_for(
    @access_rule, :method => :post, :action => @form_save_url, :id => :access_rule_form
  ) do |f|
    
    if !@access_rule.user_id.nil?
      rule_applies = 'div_user_id'
    else
      rule_applies = 'div_user_group_id'
    end
    
    f.input_hidden(:id, @access_rule.id)
    f.input_hidden(:csrf_token, get_csrf_token)
    
    f.input_radio(
      lang('access_rules.labels.rule_applies'), 
      :rule_applies, 
      rule_applies,
      :values => @rule_applies_hash
    )
    
    f.g.div(:id => 'div_user_id') do
      f.select(
        lang('access_rules.labels.user'), 
        :user_id, 
        :values   => @form_users,
        :selected => @access_rule.user_id, 
        :size     => 1
      ) 
    end
    
    f.g.div(:id => 'div_user_group_id') do
      f.select(
        lang('access_rules.labels.user_group'), 
        :user_group_id, 
        :values   => @form_groups,
        :selected => @access_rule.user_group_id, 
        :size     => 1
      )
    end
      
    f.select(
      lang('access_rules.labels.package'), 
      :package, 
      :values   => @form_packages,
      :selected => @access_rule.package, 
      :size     => 1
    )

    # Build the select boxes for all controllers
    f.g.p do
      f.g.label { lang('access_rules.labels.controller') }
      @form_controllers.each do |pkg, controllers|
        f.g.select(
          :id => "#{pkg}_controllers", :class => 'controllers hidden', :name => 'controller'
        ) do
          # Show all the options
          controllers.each do |key, value|
            args = {:value => value}

            # Is it selected?
            if value === @access_rule.controller
              args[:selected] = 'selected'
            else
              args.delete(:selected)
            end

            f.g.option(args) do
              key
            end
          end
        end
      end
    end

    f.input_radio(
      lang('access_rules.labels.create'), 
      :create_access, 
      @access_rule.create_access,
      :values => @boolean_hash
    )
  
    f.input_radio(
      lang('access_rules.labels.read'), 
      :read_access, 
      @access_rule.read_access,
      :values => @boolean_hash
    )
  
    f.input_radio(
      lang('access_rules.labels.update'), 
      :update_access, 
      @access_rule.update_access,
      :values => @boolean_hash
    )

    f.input_radio(
      lang('access_rules.labels.delete'), 
      :delete_access, 
      @access_rule.delete_access,
      :values => @boolean_hash
    )
    
    f.g.div(:class => 'clearfix') do
      f.g.div(:class => 'button') do
        f.g.input(:type => 'submit', :value => lang('access_rules.buttons.save'))
      end
    end

  end
}
